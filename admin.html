<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Jadwal FEB</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        h2 { margin-bottom: 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: #fff; }
        table, th, td { border: 1px solid #ccc; }
        th, td { padding: 10px; text-align: left; }
        input, select { padding: 8px; width: 100%; margin: 5px 0; }
        button { padding: 10px 15px; cursor: pointer; }
        #saveBtn { background: #2196F3; color: white; border: none; }
        .deleteBtn { background: red; color: white; border: none; }
        .form-container { background: white; padding: 20px; border-radius: 6px; }
    </style>
</head>
<body>

<h2>Admin Input Jadwal FEB</h2>

<div class="form-container">
    <label>Hari</label>
    <select id="hari">
        <option value="Senin">Senin</option>
        <option value="Selasa">Selasa</option>
        <option value="Rabu">Rabu</option>
        <option value="Kamis">Kamis</option>
        <option value="Jumat">Jumat</option>
        <option value="Sabtu">Sabtu</option>
        <option value="Minggu">Minggu</option>
    </select>

    <label>Tanggal</label>
    <input type="date" id="tanggal">

    <label>Waktu Mulai</label>
    <input type="time" id="mulai">

    <label>Waktu Selesai</label>
    <input type="text" id="selesai" placeholder="SELESAI atau HH:MM">

    <label>Kegiatan</label>
    <input type="text" id="kegiatan">

    <label>Tempat</label>
    <input type="text" id="tempat">

    <button id="saveBtn" onclick="saveData()">Simpan</button>
</div>

<h2>Data Jadwal</h2>
<table>
    <thead>
        <tr>
            <th>Tanggal</th>
            <th>Waktu</th>
            <th>Kegiatan</th>
            <th>Tempat</th>
            <th>Aksi</th>
        </tr>
    </thead>
    <tbody id="dataBody"></tbody>
</table>

<script>
const API = "https://script.google.com/macros/s/AKfycbzoT6zijm95CM5JRPdAMVJM0MKQoLi0pxJ9V1vGlN79VWl6uf8eFbjTztIYpUCQJWtptw/exec";

// ============================
// Format Tanggal Indonesia
// ============================
function formatTanggalIndonesia(dateStr) {
    const namaHari = ["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"];
    const namaBulan = [
        "Januari","Februari","Maret","April","Mei","Juni",
        "Juli","Agustus","September","Oktober","November","Desember"
    ];

    const d = new Date(dateStr + "T00:00:00");
    const hari = namaHari[d.getDay()];
    const tanggal = d.getDate();
    const bulan = namaBulan[d.getMonth()];
    const tahun = d.getFullYear();

    return `${hari}, ${tanggal} ${bulan} ${tahun}`;
}

// ============================
// Ambil Data
// ============================
function loadData() {
    fetch(API + "?action=read")
        .then(res => res.json())
        .then(data => renderTable(data));
}

// ============================
// Tampilkan Tabel
// ============================
function renderTable(data) {
    const tbody = document.getElementById("dataBody");
    tbody.innerHTML = "";

    data.forEach((item, index) => {
        const formattedDate = formatTanggalIndonesia(item.tanggal);

        tbody.innerHTML += `
            <tr>
                <td>${formattedDate}</td>
                <td>${item.waktu_mulai} - ${item.waktu_selesai}</td>
                <td>${item.kegiatan}</td>
                <td>${item.tempat}</td>
                <td><button class="deleteBtn" onclick="deleteData(${index + 2})">Hapus</button></td>
            </tr>
        `;
    });
}

// ============================
// Simpan Data
// ============================
function saveData() {
    const hari = document.getElementById("hari").value;
    const tanggal = document.getElementById("tanggal").value;
    const mulai = document.getElementById("mulai").value;
    const selesai = document.getElementById("selesai").value;
    const kegiatan = document.getElementById("kegiatan").value;
    const tempat = document.getElementById("tempat").value;

    if (!tanggal || !mulai || !kegiatan) {
        alert("Tanggal, waktu mulai, dan kegiatan wajib diisi");
        return;
    }

    const url = `${API}?action=create&hari=${encodeURIComponent(hari)}&tanggal=${tanggal}&waktu_mulai=${mulai}&waktu_selesai=${encodeURIComponent(selesai)}&kegiatan=${encodeURIComponent(kegiatan)}&tempat=${encodeURIComponent(tempat)}`;

    fetch(url)
        .then(res => res.json())
        .then(() => {
            loadData();
            alert("Berhasil disimpan!");
        });
}

// ============================
// Hapus Data
// ============================
function deleteData(row) {
    if (!confirm("Yakin ingin menghapus?")) return;

    fetch(`${API}?action=delete&row=${row}`)
        .then(res => res.json())
        .then(() => loadData());
}

// Load pertama kali
loadData();
</script>

</body>
</html>
