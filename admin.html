<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Admin Jadwal</title>

<style>
:root{
  --primary:#3949ab;
  --bg:#f5f7fa;
  --card:#ffffff;
  --radius:16px;
  --pad:16px;
  font-family:'Segoe UI',Roboto,Arial;
}
body{margin:0;background:var(--bg);}
.header{
  height:60px;background:var(--primary);color:#fff;
  display:flex;align-items:center;padding:0 16px;
  font-size:20px;font-weight:600
}
.container{padding:16px}

/* Search */
.search-box{
  background:#fff;padding:10px 14px;border-radius:30px;
  margin-bottom:16px;box-shadow:0 3px 8px rgba(0,0,0,0.1);
  display:flex;align-items:center
}
.search-box input{
  border:none;outline:none;font-size:16px;width:100%
}

/* Filter */
.filter-group{display:flex;gap:10px;margin-bottom:16px}
.filter-group select{
  flex:1;padding:12px;border-radius:12px;border:1px solid #ccc;
  font-size:15px
}

/* Cards */
.card{
  background:var(--card);border-radius:var(--radius);
  padding:16px;margin-bottom:16px;
  box-shadow:0 4px 10px rgba(0,0,0,0.08);
  position:relative
}
.card-title{font-size:18px;font-weight:700;margin-top:8px}
.card-meta{font-size:15px;color:#444;margin-bottom:6px}
.more-btn{
  position:absolute;right:12px;top:12px;font-size:22px;
  background:none;border:none;cursor:pointer
}
.menu{
  position:absolute;right:12px;top:38px;background:#fff;
  border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,0.15);
  padding:6px;display:none;z-index:10
}
.menu div{
  padding:8px 16px;cursor:pointer;font-size:15px
}
.menu div:hover{background:#eee}

/* Add Button */
.add-btn{
  position:fixed;right:20px;bottom:20px;
  background:var(--primary);color:#fff;
  width:60px;height:60px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-size:32px;border:none;cursor:pointer;
  box-shadow:0 6px 14px rgba(0,0,0,0.2)
}

/* Modal */
.modal-bg{
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.4);display:none;
  align-items:center;justify-content:center
}
.modal{
  background:#fff;width:90%;max-width:380px;border-radius:14px;padding:20px
}
.modal h2{margin:0 0 10px;font-size:20px;font-weight:700}
input,select{
  width:100%;padding:10px;margin-top:6px;margin-bottom:12px;
  font-size:15px;border-radius:10px;border:1px solid #ccc
}
.modal button{
  padding:10px 16px;font-size:16px;border:none;
  border-radius:10px;cursor:pointer;margin-top:4px
}
.btn-save{background:var(--primary);color:#fff}
.btn-cancel{background:#aaa;color:#fff;margin-left:6px}
</style>
</head>

<body>
<div class="header">Admin Jadwal</div>
<div class="container">

  <!-- Search -->
  <div class="search-box">
    <input id="search" placeholder="Cari kegiatan atau tempat..." />
  </div>

  <!-- Filters -->
  <div class="filter-group">
    <select id="filterHari">
      <option value="">Semua Hari</option>
    </select>
    <select id="filterTempat">
      <option value="">Semua Tempat</option>
    </select>
  </div>

  <div id="list"></div>
</div>

<button class="add-btn" onclick="openAdd()">+</button>

<!-- Modal -->
<div class="modal-bg" id="modalBg">
  <div class="modal">
    <h2 id="modalTitle">Tambah Jadwal</h2>

    <select id="f_hari">
      <option value="">Pilih Hari</option>
      <option>Senin</option><option>Selasa</option>
      <option>Rabu</option><option>Kamis</option>
      <option>Jumat</option><option>Sabtu</option><option>Minggu</option>
    </select>

    <input id="f_tanggal" type="date" />
    <input id="f_mulai" type="time" />
    <input id="f_selesai" type="time" />
    <input id="f_kegiatan" placeholder="Nama kegiatan" />
    <input id="f_tempat" placeholder="Tempat" />

    <button class="btn-save" onclick="saveData()">Simpan</button>
    <button class="btn-cancel" onclick="closeModal()">Batal</button>
  </div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwpVOjv86huLkyISvEmfgtrnfjDaiBpGL2eF9X53ZtU4ssXIONITQtMj1aXeBgDTIQexg/exec";

let dataRaw = [];
let editIndex = -1;

/* ========== UTIL ========== */

// Format 08:00
function fixTime(str){
  if(!str) return "";
  let [h,m] = str.split(":");
  h = h.padStart(2,"0");
  m = (m||"00").padStart(2,"0");
  return `${h}:${m}`;
}

// Format tanggal: JUMAT, 28 NOVEMBER 2025
function indoTanggal(tgl){
  const d = new Date(tgl);
  const day = ["MINGGU","SENIN","SELASA","RABU","KAMIS","JUMAT","SABTU"][d.getDay()];
  const bulan = ["JANUARI","FEBRUARI","MARET","APRIL","MEI","JUNI","JULI","AGUSTUS","SEPTEMBER","OKTOBER","NOVEMBER","DESEMBER"][d.getMonth()];
  return `${day}, ${d.getDate()} ${bulan} ${d.getFullYear()}`;
}


/* ========== LOAD DATA ========== */
function loadData(){
  fetch(API_URL)
    .then(r=>r.json())
    .then(d=>{
      dataRaw = d;
      populateFilters();
      render();
    });
}

/* ========== FILTERS ========== */
function populateFilters(){
  const hariSet = new Set();
  const tempatSet = new Set();

  dataRaw.forEach(r=>{
    if(r.hari) hariSet.add(r.hari);
    if(r.tempat) tempatSet.add(r.tempat);
  });

  const hSel = document.getElementById("filterHari");
  const tSel = document.getElementById("filterTempat");

  [...hariSet].sort().forEach(h=>{
    const o = document.createElement("option");
    o.value = h; o.textContent = h;
    hSel.appendChild(o);
  });

  [...tempatSet].sort().forEach(t=>{
    const o = document.createElement("option");
    o.value = t; o.textContent = t;
    tSel.appendChild(o);
  });
}

/* ========== RENDER LIST ========== */
function render(){
  const q = search.value.toLowerCase();
  const fH = filterHari.value;
  const fT = filterTempat.value;

  const list = document.getElementById("list");
  list.innerHTML = "";

  dataRaw
    .filter(r=>{
      if(fH && r.hari !== fH) return false;
      if(fT && r.tempat !== fT) return false;

      return (
        r.kegiatan.toLowerCase().includes(q) ||
        r.tempat.toLowerCase().includes(q)
      );
    })
    .forEach((r,i)=>{
      const mulai = fixTime(r.waktu_mulai);
      const selesai = r.waktu_selesai ? fixTime(r.waktu_selesai) : "SELESAI";

      const div = document.createElement("div");
      div.className="card";

      div.innerHTML = `
        <button class='more-btn' onclick='toggleMenu(${i})'>‚ãÆ</button>
        <div class='menu' id='menu-${i}'>
          <div onclick='editItem(${i})'>Edit</div>
          <div onclick='deleteItem(${i})'>Hapus</div>
        </div>

        <div class='card-meta' style="font-weight:700">${indoTanggal(r.tanggal)}</div>
        <div class='card-meta'>${mulai} - ${selesai}</div>
        <div class='card-title'>${r.kegiatan.toUpperCase()}</div>
        <div class='card-meta'>üìç ${r.tempat}</div>
      `;

      list.appendChild(div);
    });
}

search.oninput = render;
filterHari.onchange = render;
filterTempat.onchange = render;

/* ========== MENU ========== */
function toggleMenu(i){
  const m = document.getElementById(`menu-${i}`);
  m.style.display = m.style.display==="block" ? "none" : "block";
}

/* ========== ADD / EDIT ========== */
function openAdd(){
  editIndex=-1;
  clearForm();
  modalTitle.innerText="Tambah Jadwal";
  modalBg.style.display="flex";
}
function clearForm(){
  f_hari.value="";
  f_tanggal.value="";
  f_mulai.value="";
  f_selesai.value="";
  f_kegiatan.value="";
  f_tempat.value="";
}
function closeModal(){ modalBg.style.display="none"; }

function editItem(i){
  editIndex=i;
  const r = dataRaw[i];
  f_hari.value=r.hari;
  f_tanggal.value=r.tanggal;
  f_mulai.value=r.waktu_mulai;
  f_selesai.value=r.waktu_selesai;
  f_kegiatan.value=r.kegiatan;
  f_tempat.value=r.tempat;

  modalTitle.innerText="Edit Jadwal";
  modalBg.style.display="flex";
}

function saveData(){
  const obj={
    hari:f_hari.value,
    tanggal:f_tanggal.value,
    waktu_mulai:f_mulai.value,
    waktu_selesai:f_selesai.value,
    kegiatan:f_kegiatan.value,
    tempat:f_tempat.value
  };

  if(editIndex===-1){
    obj.action="add";
  } else {
    obj.action="edit";
    obj.row=editIndex+2;
  }

  fetch(API_URL,{method:"POST",body:JSON.stringify(obj)})
    .then(r=>r.text())
    .then(()=>{ closeModal(); loadData(); });
}

function deleteItem(i){
  const row = i+2;
  fetch(API_URL,{method:"POST",body:JSON.stringify({action:"delete",row})})
    .then(r=>r.text())
    .then(()=>loadData());
}

/* INIT */
loadData();
</script>

</body>
</html>
