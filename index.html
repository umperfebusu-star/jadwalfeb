<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Jadwal Kegiatan FEB USU</title>
<style>
:root{
  --primary:#3742fa;
  --bg1:#0ab6ff;
  --bg2:#0077ff;
  --card:#ffffff;
  --radius:18px;
  font-family:'Segoe UI',Arial;
}
body{margin:0;background:linear-gradient(135deg,var(--bg1),var(--bg2));min-height:100vh;color:#fff;}
.header{
  padding:18px;text-align:center;font-size:22px;font-weight:700;
  background:rgba(0,0,0,0.25);
}
.container{padding:16px;}
.search{
  background:#fff;color:#000;padding:10px 14px;border-radius:16px;
  margin-bottom:12px;font-size:16px;border:none;width:100%;
}
select{
  width:100%;padding:12px;border:none;border-radius:14px;margin-bottom:12px;font-size:16px;
}
.card{
  background:#fff;color:#000;border-radius:16px;padding:16px;margin-bottom:16px;
  box-shadow:0 4px 12px rgba(0,0,0,0.2);
}
.card .tgl{font-weight:700;margin-bottom:6px;font-size:17px;}
.card .jam{font-size:15px;margin-bottom:4px;}
.card .title{font-weight:800;margin:6px 0;font-size:18px;}
.card .tempat{font-size:15px;}
</style>
</head>
<body>
<div class="header">Jadwal Kegiatan FEB USU</div>

<div class="container">
  <input id="search" class="search" placeholder="Cari kegiatan, ruangan, atau hari..." />

  <select id="filterHari">
    <option value="">Filter: Semua Hari</option>
    <option>Senin</option><option>Selasa</option><option>Rabu</option><option>Kamis</option>
    <option>Jumat</option><option>Sabtu</option><option>Minggu</option>
  </select>

  <select id="filterTempat">
    <option value="">Filter: Semua Tempat</option>
  </select>

  <div id="list"></div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwpVOjv86huLkyISvEmfgtrnfjDaiBpGL2eF9X53ZtU4ssXIONITQtMj1aXeBgDTIQexg/exec";
let dataRaw=[];

function formatWaktu(val){
  if(!val) return "";
  if(val.toLowerCase()==="selesai") return "SELESAI";
  let s = val.replace('.',':');
  let [h,m] = s.split(":");
  if(!m) m="00";
  return h.padStart(2,"0")+":"+m.padStart(2,"0");
}

function formatTanggal(iso){
  const d=new Date(iso);
  if(isNaN(d)) return iso;
  const hari=d.toLocaleDateString("id-ID",{weekday:"long"}).toUpperCase();
  const t=String(d.getDate()).padStart(2,"0");
  const bln=d.toLocaleDateString("id-ID",{month:"long"}).toUpperCase();
  const y=d.getFullYear();
  return `${hari}, ${t} ${bln} ${y}`;
}

async function loadData(){
  const res=await fetch(API_URL);
  const data=await res.json();
  dataRaw=data;

  const tempatSet=new Set();
  data.forEach(r=>{ if(r.tempat) tempatSet.add(r.tempat); });
  const sel=document.getElementById("filterTempat");
  sel.innerHTML='<option value="">Filter: Semua Tempat</option>';
  [...tempatSet].sort().forEach(t=>{
    const o=document.createElement("option");o.value=t;o.textContent=t;sel.appendChild(o);
  });

  render();
}

function render(){
  const q=document.getElementById("search").value.toLowerCase();
  const fH=document.getElementById("filterHari").value;
  const fT=document.getElementById("filterTempat").value;
  const box=document.getElementById("list");
  box.innerHTML="";

  const filtered=dataRaw.filter(r=>{
    if(fH && r.hari!==fH) return false;
    if(fT && r.tempat!==fT) return false;
    const txt=(r.kegiatan+" "+r.tempat+" "+r.hari).toLowerCase();
    if(q && !txt.includes(q)) return false;
    return true;
  });

  filtered.forEach(r=>{
    const c=document.createElement("div");
    c.className="card";
    c.innerHTML=`
      <div class='tgl'>${formatTanggal(r.tanggal)}</div>
      <div class='jam'>${formatWaktu(r.waktu_mulai)} - ${formatWaktu(r.waktu_selesai)}</div>
      <div class='title'>${r.kegiatan ? r.kegiatan.toUpperCase() : ''}</div>
      <div class='tempat'>üìç ${r.tempat || ''}</div>
    `;
    box.appendChild(c);
  });
}

document.getElementById("search").addEventListener('input',render);
document.getElementById("filterHari").addEventListener('change',render);
document.getElementById("filterTempat").addEventListener('change',render);

loadData();
</script>

</body>
</html>
